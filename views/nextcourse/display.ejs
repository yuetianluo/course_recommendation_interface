<div class="mini-banner auto">
	<div class="container">
		<h2>Recommendation</h2>
	</div>
</div>

<div class="sub-banner">
  <div class="container">
    <h2>Find courses you would like to take!</h2>
    <h4>
    	Don's know what course you can take next, also don't have wise guidance on your course plan. Don't worry! You can find the best courses you can take next here! We will give best recommendations to you based on your history.
  </div>
</div>

<div class="container wrapper">
<div class="row">
<h4>If you want to specify the dapartment offer the course, please choose here</h4>
	<form method="POST" action="/nextcourse/search" >
		<div class="col-md-6">
		<select name="department" class="department-list form-control" id="departmentlist" style="width:400px">
			<option></option>
	        <% _.each(departments, function(department) { %>
	        <option value="<%=department.id%>"><%=department.departmentName%></option>
	        <%})%>
		</select>	
    <br>
    <br>
    <input type='text' name="ppsk" id='ppsk' placeholder="Please enter a ppsk here" size='30'>	
    <br>
    <p>7 digits, example:2426080, 2425472</p>
    
	</div>

	<div class="col-md-6">
  <select class="coursesubject-list form-control" id="coursesubjectlist" name="coursesubjectName" style="width:400px">
    <option></option>
    <% _.each(coursesubjects, function(coursesubject) { %>
      <option value="<%=coursesubject.departmentid.id%>"><%=coursesubject.coursesubjectName%></option>
      <%})%>
    </select>
    <br>
    <br>
    <input class="btn btn-md btn-success " id='nextcoursesubmit' style="width:400px" value="Please click here to find suitable courses for you!">
  </div>
    <select class="coursesubject-list form-control hidden" id="coursesubjectlist2" name="coursesubjectName" style="width:400px" >
    <option></option><!--hidden select bar, so that you can choose it again-->
    <% _.each(coursesubjects, function(coursesubject) { %>
      <option value="<%=coursesubject.departmentid.id%>"><%=coursesubject.coursesubjectName%></option>
      <%})%>
    </select> 
    
	</form>
  <br>
  <br>
</div>    
<div id='addtable'>
  <!--ajax add table-->
  </div>
  <br>
  <br>
  <div id= "coursehistory">
    
  </div>

</div>


<script type="text/javascript">
  $(document).ready(function(){
    $("#nextcoursesubmit").click(function(){
      var ppsk=$("#ppsk").val();
      $.ajax({
        url:'/nextcourse/predict',
        type:'POST',
        data:{
          ppsk:ppsk  //be careful there is no punctuation
        },
        success:function(response){
          $('#course-table').remove();
          $('#course-table2').remove();
          $('#title').remove();
          $('#title2').remove();
          //console.log(response);//you can use this method to see data you pass to browser
          var trHTML = "<h3 id='title'>Our Recommendation is:</h3><table class='table table-striped table-hover' id='course-table'><thead><tr><th>Course ID</th><th>Course Name</th><th>Course Subject</th><th>Department </th></tr></thead><tbody>";
          var trHTML2 = "<h3 id='title2'>His/Her course history is:</h3><table class='table table-striped table-hover' id='course-table2'><thead><tr><th>Course ID</th><th>Course Name</th><th>Course Subject</th><th>Department </th></tr></thead><tbody>";
          //the following part need to be changed
          $.each(response, function (i, item) {
            if (i < 6) {
              trHTML += '<tr><td>' + item.id + '</td><td>' + item.courseName + '</td><td>' + item.coursesubjectid.coursesubjectName + '</td><td>'+item.departmentid.departmentName+'</td></tr>';
            } else{
              trHTML2 += '<tr><td>' + item.id + '</td><td>' + item.courseName + '</td><td>' + item.coursesubjectid.coursesubjectName + '</td><td>'+item.departmentid.departmentName+'</td></tr>';
            }
            
          });
          trHTML +="</tbody></table>"
          trHTML2 +="</tbody></table>"
          $('#addtable').append(trHTML);
          $('#coursehistory').append(trHTML2);
        },
        failure:function(msg){
          $('#addtable').append('<div class="alert alert-danger" id="courseerror"><h3>'+msg+'</h3></div>')
        },
        error:function(jqXHR, textStatus,errorMessage){
        $('#course-table').remove();
          $('#course-table2').remove();
          $('#title').remove();
          $('#title2').remove();
        $('#addtable').append('<div class="alert alert-danger" id="course-table"><h3>Sorry, This ppsk does not exist!</h3></div>')
        }
      })
    });
  });
</script>


  <script type="text/javascript">
  $(document).ready(function() {
  $("#departmentlist")
   .select2({
    placeholder:'Please choose a department here if you like'
  }).on("change",function() {////////////////this is a way to add "change" event
  if ($(this).val()!="Not specified"){
  //if ($(this).data('options') == undefined) {////
    /*Taking an array of all options-2 and kind of embedding it on the select1*/
    $(this).data('options', $('#coursesubjectlist2 option').clone());
      var id = $(this).val();
  var options = $(this).data('options').filter('[value=' + id + ']');

  $('#coursesubjectlist').html(options);
    $('#coursesubjectlist').append($('<option>', {
    value: 'Not specified',
    text: 'Not Specified'
    }));

  }else{
    $(this).data('options', $('#coursesubjectlist2 option').clone());
    var options = $(this).data('options')
     $('#coursesubjectlist').html(options);
  }
})
});
</script>  


<script type="text/javascript">
  $(document).ready(function() {
  $("#coursesubjectlist").select2({
  	placeholder:'Please specify a course subject here if you like'
  });
});
</script>

<!-- <script>
  // Table pagination
  $(document).ready(function() {
      $('#course-table').dataTable();
  });
</script> -->
